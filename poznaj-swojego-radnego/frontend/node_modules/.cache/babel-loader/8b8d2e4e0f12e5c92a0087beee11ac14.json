{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nexport class PostgrestBuilder {\n  constructor(builder) {\n    Object.assign(this, builder);\n    let _fetch;\n    if (builder.fetch) {\n      _fetch = builder.fetch;\n    } else if (typeof fetch === 'undefined') {\n      _fetch = (...args) => __awaiter(this, void 0, void 0, function* () {\n        return yield (yield import('cross-fetch')).fetch(...args);\n      });\n    } else {\n      _fetch = fetch;\n    }\n    this.fetch = (...args) => _fetch(...args);\n    this.shouldThrowOnError = builder.shouldThrowOnError || false;\n    this.allowEmpty = builder.allowEmpty || false;\n  }\n  /**\n   * If there's an error with the query, throwOnError will reject the promise by\n   * throwing the error instead of returning it as part of a successful response.\n   *\n   * {@link https://github.com/supabase/supabase-js/issues/92}\n   */\n  throwOnError(throwOnError) {\n    if (throwOnError === null || throwOnError === undefined) {\n      throwOnError = true;\n    }\n    this.shouldThrowOnError = throwOnError;\n    return this;\n  }\n  then(onfulfilled, onrejected) {\n    // https://postgrest.org/en/stable/api.html#switching-schemas\n    if (typeof this.schema === 'undefined') {\n      // skip\n    } else if (['GET', 'HEAD'].includes(this.method)) {\n      this.headers['Accept-Profile'] = this.schema;\n    } else {\n      this.headers['Content-Profile'] = this.schema;\n    }\n    if (this.method !== 'GET' && this.method !== 'HEAD') {\n      this.headers['Content-Type'] = 'application/json';\n    }\n    let res = this.fetch(this.url.toString(), {\n      method: this.method,\n      headers: this.headers,\n      body: JSON.stringify(this.body),\n      signal: this.signal\n    }).then(res => __awaiter(this, void 0, void 0, function* () {\n      var _a, _b, _c, _d;\n      let error = null;\n      let data = null;\n      let count = null;\n      let status = res.status;\n      let statusText = res.statusText;\n      if (res.ok) {\n        const isReturnMinimal = (_a = this.headers['Prefer']) === null || _a === void 0 ? void 0 : _a.split(',').includes('return=minimal');\n        if (this.method !== 'HEAD' && !isReturnMinimal) {\n          const text = yield res.text();\n          if (!text) {\n            // discard `text`\n          } else if (this.headers['Accept'] === 'text/csv') {\n            data = text;\n          } else {\n            data = JSON.parse(text);\n          }\n        }\n        const countHeader = (_b = this.headers['Prefer']) === null || _b === void 0 ? void 0 : _b.match(/count=(exact|planned|estimated)/);\n        const contentRange = (_c = res.headers.get('content-range')) === null || _c === void 0 ? void 0 : _c.split('/');\n        if (countHeader && contentRange && contentRange.length > 1) {\n          count = parseInt(contentRange[1]);\n        }\n      } else {\n        const body = yield res.text();\n        try {\n          error = JSON.parse(body);\n        } catch (_e) {\n          error = {\n            message: body\n          };\n        }\n        if (error && this.allowEmpty && ((_d = error === null || error === void 0 ? void 0 : error.details) === null || _d === void 0 ? void 0 : _d.includes('Results contain 0 rows'))) {\n          error = null;\n          status = 200;\n          statusText = 'OK';\n        }\n        if (error && this.shouldThrowOnError) {\n          throw error;\n        }\n      }\n      const postgrestResponse = {\n        error,\n        data,\n        count,\n        status,\n        statusText,\n        body: data\n      };\n      return postgrestResponse;\n    }));\n    if (!this.shouldThrowOnError) {\n      res = res.catch(fetchError => ({\n        error: {\n          message: `FetchError: ${fetchError.message}`,\n          details: '',\n          hint: '',\n          code: fetchError.code || ''\n        },\n        data: null,\n        body: null,\n        count: null,\n        status: 400,\n        statusText: 'Bad Request'\n      }));\n    }\n    return res.then(onfulfilled, onrejected);\n  }\n}","map":{"version":3,"names":["PostgrestBuilder","constructor","builder","Object","assign","_fetch","fetch","args","__awaiter","shouldThrowOnError","allowEmpty","throwOnError","undefined","then","onfulfilled","onrejected","schema","includes","method","headers","res","url","toString","body","JSON","stringify","signal","error","data","count","status","statusText","ok","isReturnMinimal","_a","split","text","parse","countHeader","_b","match","contentRange","_c","get","length","parseInt","_e","message","_d","details","postgrestResponse","catch","fetchError","hint","code"],"sources":["../../../src/lib/types.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA,OAAM,MAAgBA,gBAAgB;EAWpCC,YAAYC,OAA4B;IACtCC,MAAM,CAACC,MAAM,CAAC,IAAI,EAAEF,OAAO,CAAC;IAC5B,IAAIG,MAAa;IACjB,IAAIH,OAAO,CAACI,KAAK,EAAE;MACjBD,MAAM,GAAGH,OAAO,CAACI,KAAK;KACvB,MAAM,IAAI,OAAOA,KAAK,KAAK,WAAW,EAAE;MACvCD,MAAM,GAAGA,CAAO,GAAGE,IAAI,KAAIC,SAAA;QAAC,aAAM,CAAC,MAAM,MAAM,CAAC,aAAa,CAAC,EAAEF,KAAK,CAAC,GAAGC,IAAI,CAAC;MAAA;KAC/E,MAAM;MACLF,MAAM,GAAGC,KAAK;;IAEhB,IAAI,CAACA,KAAK,GAAG,CAAC,GAAGC,IAAI,KAAKF,MAAM,CAAC,GAAGE,IAAI,CAAC;IACzC,IAAI,CAACE,kBAAkB,GAAGP,OAAO,CAACO,kBAAkB,IAAI,KAAK;IAC7D,IAAI,CAACC,UAAU,GAAGR,OAAO,CAACQ,UAAU,IAAI,KAAK;EAC/C;EAEA;;;;;;EAMAC,YAAYA,CAACA,YAAsB;IACjC,IAAIA,YAAY,KAAK,IAAI,IAAIA,YAAY,KAAKC,SAAS,EAAE;MACvDD,YAAY,GAAG,IAAI;;IAErB,IAAI,CAACF,kBAAkB,GAAGE,YAAY;IACtC,OAAO,IAAI;EACb;EAEAE,IAAIA,CACFC,WAGQ,EACRC,UAAmF;IAEnF;IACA,IAAI,OAAO,IAAI,CAACC,MAAM,KAAK,WAAW,EAAE;MACtC;IAAA,CACD,MAAM,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC,CAACC,QAAQ,CAAC,IAAI,CAACC,MAAM,CAAC,EAAE;MAChD,IAAI,CAACC,OAAO,CAAC,gBAAgB,CAAC,GAAG,IAAI,CAACH,MAAM;KAC7C,MAAM;MACL,IAAI,CAACG,OAAO,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAACH,MAAM;;IAE/C,IAAI,IAAI,CAACE,MAAM,KAAK,KAAK,IAAI,IAAI,CAACA,MAAM,KAAK,MAAM,EAAE;MACnD,IAAI,CAACC,OAAO,CAAC,cAAc,CAAC,GAAG,kBAAkB;;IAGnD,IAAIC,GAAG,GAAG,IAAI,CAACd,KAAK,CAAC,IAAI,CAACe,GAAG,CAACC,QAAQ,EAAE,EAAE;MACxCJ,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBI,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACF,IAAI,CAAC;MAC/BG,MAAM,EAAE,IAAI,CAACA;KACd,CAAC,CAACb,IAAI,CAAQO,GAAG,IAAIZ,SAAA;;MACpB,IAAImB,KAAK,GAAG,IAAI;MAChB,IAAIC,IAAI,GAAG,IAAI;MACf,IAAIC,KAAK,GAAG,IAAI;MAChB,IAAIC,MAAM,GAAGV,GAAG,CAACU,MAAM;MACvB,IAAIC,UAAU,GAAGX,GAAG,CAACW,UAAU;MAE/B,IAAIX,GAAG,CAACY,EAAE,EAAE;QACV,MAAMC,eAAe,IAAAC,EAAA,GAAG,IAAI,CAACf,OAAO,CAAC,QAAQ,CAAC,cAAAe,EAAA,uBAAAA,EAAA,CAAEC,KAAK,CAAC,GAAG,EAAElB,QAAQ,CAAC,gBAAgB,CAAC;QACrF,IAAI,IAAI,CAACC,MAAM,KAAK,MAAM,IAAI,CAACe,eAAe,EAAE;UAC9C,MAAMG,IAAI,GAAG,MAAMhB,GAAG,CAACgB,IAAI,EAAE;UAC7B,IAAI,CAACA,IAAI,EAAE;YACT;UAAA,CACD,MAAM,IAAI,IAAI,CAACjB,OAAO,CAAC,QAAQ,CAAC,KAAK,UAAU,EAAE;YAChDS,IAAI,GAAGQ,IAAI;WACZ,MAAM;YACLR,IAAI,GAAGJ,IAAI,CAACa,KAAK,CAACD,IAAI,CAAC;;;QAI3B,MAAME,WAAW,IAAAC,EAAA,GAAG,IAAI,CAACpB,OAAO,CAAC,QAAQ,CAAC,cAAAoB,EAAA,uBAAAA,EAAA,CAAEC,KAAK,CAAC,iCAAiC,CAAC;QACpF,MAAMC,YAAY,IAAAC,EAAA,GAAGtB,GAAG,CAACD,OAAO,CAACwB,GAAG,CAAC,eAAe,CAAC,cAAAD,EAAA,uBAAAA,EAAA,CAAEP,KAAK,CAAC,GAAG,CAAC;QACjE,IAAIG,WAAW,IAAIG,YAAY,IAAIA,YAAY,CAACG,MAAM,GAAG,CAAC,EAAE;UAC1Df,KAAK,GAAGgB,QAAQ,CAACJ,YAAY,CAAC,CAAC,CAAC,CAAC;;OAEpC,MAAM;QACL,MAAMlB,IAAI,GAAG,MAAMH,GAAG,CAACgB,IAAI,EAAE;QAE7B,IAAI;UACFT,KAAK,GAAGH,IAAI,CAACa,KAAK,CAACd,IAAI,CAAC;SACzB,CAAC,OAAAuB,EAAA,EAAM;UACNnB,KAAK,GAAG;YACNoB,OAAO,EAAExB;WACV;;QAGH,IAAII,KAAK,IAAI,IAAI,CAACjB,UAAU,MAAAsC,EAAA,GAAIrB,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEsB,OAAO,cAAAD,EAAA,uBAAAA,EAAA,CAAE/B,QAAQ,CAAC,wBAAwB,EAAC,EAAE;UAClFU,KAAK,GAAG,IAAI;UACZG,MAAM,GAAG,GAAG;UACZC,UAAU,GAAG,IAAI;;QAGnB,IAAIJ,KAAK,IAAI,IAAI,CAAClB,kBAAkB,EAAE;UACpC,MAAMkB,KAAK;;;MAIf,MAAMuB,iBAAiB,GAAG;QACxBvB,KAAK;QACLC,IAAI;QACJC,KAAK;QACLC,MAAM;QACNC,UAAU;QACVR,IAAI,EAAEK;OACP;MAED,OAAOsB,iBAAiB;IAC1B,CAAC,EAAC;IACF,IAAI,CAAC,IAAI,CAACzC,kBAAkB,EAAE;MAC5BW,GAAG,GAAGA,GAAG,CAAC+B,KAAK,CAAEC,UAAU,KAAM;QAC/BzB,KAAK,EAAE;UACLoB,OAAO,EAAE,eAAeK,UAAU,CAACL,OAAO,EAAE;UAC5CE,OAAO,EAAE,EAAE;UACXI,IAAI,EAAE,EAAE;UACRC,IAAI,EAAEF,UAAU,CAACE,IAAI,IAAI;SAC1B;QACD1B,IAAI,EAAE,IAAI;QACVL,IAAI,EAAE,IAAI;QACVM,KAAK,EAAE,IAAI;QACXC,MAAM,EAAE,GAAG;QACXC,UAAU,EAAE;OACb,CAAC,CAAC;;IAGL,OAAOX,GAAG,CAACP,IAAI,CAACC,WAAW,EAAEC,UAAU,CAAC;EAC1C","ignoreList":[]},"metadata":{},"sourceType":"module"}